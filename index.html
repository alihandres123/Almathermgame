<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ò–≥—Ä–∞ –ø–æ –∑–∞–∫—É–ø—É ALMATHERM</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      max-width: 800px;
      margin: auto;
      padding: 20px;
      background-color: #f9f9f9;
      color: #1d439c;
    }
    h1 {
      color: #e1261c;
    }
    button {
      background-color: #1d439c;
      color: white;
      border: none;
      padding: 8px 16px;
      margin-top: 10px;
      cursor: pointer;
      border-radius: 4px;
    }
    button:hover {
      background-color: #15377a;
    }
    input[type="number"] {
      width: 60px;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 4px;
    }
    select {
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 4px;
    }
    .log {
      background: #eef0f7;
      padding: 10px;
      height: 200px;
      overflow-y: scroll;
      margin-top: 10px;
      border-left: 4px solid #1d439c;
    }
    .truck-animation {
      margin-top: 10px;
      height: 30px;
      background: #ddd;
      position: relative;
      overflow: hidden;
    }
    .truck {
      position: absolute;
      left: 0;
      top: 0;
      width: 30px;
      height: 30px;
      background: #e1261c;
      text-align: center;
      color: white;
      line-height: 30px;
      animation: drive linear forwards;
    }
    @keyframes drive {
      from { left: 0; }
      to { left: 100%; }
    }
  </style>
</head>
<body>
  <img src="1.png" alt="–õ–æ–≥–æ—Ç–∏–ø –ê–ª–º–∞—Ç–µ—Ä–º" style="height: 80px; display: block; margin-bottom: 10px;">
  <h1>üßæ –ò–≥—Ä–∞ –ø–æ –∑–∞–∫—É–ø—É ALMATHERM</h1>
  <p><strong>üìå –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤:</strong><br>
    A ‚Äî –¢—Ä—É–±—ã –∏ —Ñ–∏—Ç–∏–Ω–≥–∏ –ü–ü–†: —Ö–æ–¥–æ–≤–æ–π —Ç–æ–≤–∞—Ä, –¥–µ—à—ë–≤—ã–π, —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Å–ø—Ä–æ—Å<br>
    B ‚Äî –°–º–µ—Å–∏—Ç–µ–ª–∏ –∏ –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ: —Å—Ä–µ–¥–Ω—è—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Å–ø—Ä–æ—Å–∞<br>
    C ‚Äî –†–∞–¥–∏–∞—Ç–æ—Ä—ã Royal Thermo: —Ä–µ–¥–∫–æ –ø—Ä–æ–¥–∞—é—Ç—Å—è, –¥–æ—Ä–æ–≥–∏–µ, –≤—ã—Å–æ–∫–∞—è –ø—Ä–∏–±—ã–ª—å</p>
  <p id="day">–î–µ–Ω—å: 1</p>
  <p id="stats" style="margin-bottom: 10px; font-size: 14px;"></p>


  <h3>üöõ –ó–∞–∫–∞–∑</h3>
  <label for="vehicle">–¢–∏–ø –º–∞—à–∏–Ω—ã:</label>
  <select id="vehicle">
    <option value="small">–ú–∞–ª—ã–π –∞–≤—Ç–æ (25 –µ–¥, $60, 1 –¥–µ–Ω—å)</option>
    <option value="gazelle">–ì–∞–∑–µ–ª—å (65 –µ–¥, $95, 2 –¥–Ω—è)</option>
    <option value="truck">–§—É—Ä–∞ (120 –µ–¥, $140, 3 –¥–Ω—è)</option>
  </select>
  <div>
    –¢—Ä—É–±—ã –ü–ü–†: <input type="number" id="orderA" value="0" min="0"> 
    –°–º–µ—Å–∏—Ç–µ–ª–∏: <input type="number" id="orderB" value="0" min="0"> 
    –†–∞–¥–∏–∞—Ç–æ—Ä—ã RT: <input type="number" id="orderC" value="0" min="0">
  </div>
  <div id="orderSummary" style="margin-top: 10px; font-size: 14px; color: #444;">
    üí° <strong>–†–∞—Å—á—ë—Ç:</strong><br>
    –¢—Ä—É–±—ã –ü–ü–†: $<span id="costA">0.00</span>, 
    –°–º–µ—Å–∏—Ç–µ–ª–∏: $<span id="costB">0.00</span>, 
    –†–∞–¥–∏–∞—Ç–æ—Ä—ã: $<span id="costC">0.00</span><br>
    –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: $<span id="transportCost">0.00</span><br>
    <strong>–ò—Ç–æ–≥–æ:</strong> $<span id="totalOrderCost">0.00</span>
  </div>
  <button onclick="placeOrder()">üöö –°–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑</button>

  <br><br>
  <button onclick="nextDay()">‚è≠ –°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å</button>
  <div class="truck-animation" id="truckAnim"></div>
  <div class="log" id="log"></div>
  <canvas id="chart" width="800" height="300"></canvas>

<script>
const stock = { A: 40, B: 40, C: 40 };
const incoming = [[], [], [], [], [], []];
const vehicles = {
  small: { name: '–ú–∞–ª—ã–π –∞–≤—Ç–æ', capacity: 25, cost: 60, days: 1 },
  gazelle: { name: '–ì–∞–∑–µ–ª—å', capacity: 65, cost: 95, days: 2 },
  truck: { name: '–§—É—Ä–∞', capacity: 120, cost: 140, days: 3 }
};
const purchasePrice = { A: 1.5, B: 1.8, C: 2.2 };

let day = 1;
let noOrderDays = 0;
let totalCost = 0;
let budget = 400;
let salary = 10;
let rent = 35;
let orderPlacedToday = false;

const logDiv = document.getElementById("log");
const truckAnim = document.getElementById("truckAnim");
const truckQueue = [];

const chartCtx = document.getElementById('chart').getContext('2d');
const chartData = {
  labels: [],
  datasets: [
    { label: '–û–±—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫', data: [], borderColor: 'blue', fill: false },
    { label: '–ü—Ä–æ–¥–∞–Ω–æ –≤ –¥–µ–Ω—å', data: [], borderColor: 'green', fill: false }
  ]
};
const gameChart = new Chart(chartCtx, {
  type: 'line',
  data: chartData,
  options: {
    responsive: false,
    plugins: {
      legend: { position: 'top' },
      title: { display: true, text: 'üìä –î–∏–Ω–∞–º–∏–∫–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ –ø—Ä–æ–¥–∞–∂' }
    }
  }
});

const demandModel = {
  A: Array.from({ length: 30 }, (_, i) => Math.random() < 0.1 ? Math.floor(Math.random() * 11 + 30) : Math.max(0, Math.floor(16 + Math.sin(i / 2.5) * 4 + (Math.random() - 0.5) * 8))),
  B: Array.from({ length: 30 }, (_, i) => Math.random() < 0.1 ? Math.floor(Math.random() * 11 + 35) : Math.max(0, Math.floor(16 + Math.sin(i / 4) * 7 + (Math.random() - 0.5) * 12))),
  C: Array.from({ length: 30 }, () => 0)
};
[2, 6, 11, 16, 20, 25, 28].forEach(d => demandModel.C[d] = Math.floor(Math.random() * 36 + 25));
demandModel.C[Math.floor(Math.random() * 30)] = Math.floor(Math.random() * 21 + 70);

const shortages = { A: 0, B: 0, C: 0 };
const penaltyTimers = { A: 0, B: 0, C: 0 };

function updateUI() {
  document.getElementById("day").textContent = `üìÖ –î–µ–Ω—å: ${day}`;
  document.getElementById("stats").innerHTML =
    `üì¶ –û—Å—Ç–∞—Ç–∫–∏ ‚Äî A: ${stock.A} B: ${stock.B} C: ${stock.C} &nbsp;|&nbsp; üí∞ –ë—é–¥–∂–µ—Ç: $${budget.toFixed(2)} &nbsp;|&nbsp; üìâ –ó–∞—Ç—Ä–∞—Ç—ã: $${totalCost.toFixed(2)}`;
}

function log(msg) {
  logDiv.innerHTML += `<div>${msg}</div>`;
  logDiv.scrollTop = logDiv.scrollHeight;
}

function placeOrder() {
  if (orderPlacedToday) return alert("–í—ã –º–æ–∂–µ—Ç–µ –¥–µ–ª–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∑–∞–∫–∞–∑ –≤ –¥–µ–Ω—å!");
  const v = vehicles[document.getElementById("vehicle").value];
  const A = +document.getElementById("orderA").value || 0;
  const B = +document.getElementById("orderB").value || 0;
  const C = +document.getElementById("orderC").value || 0;
  const totalQty = A + B + C;
  const purchaseCost = A * purchasePrice.A + B * purchasePrice.B + C * purchasePrice.C;
  const totalOrderCost = v.cost + purchaseCost;
  if (totalQty === 0 || totalQty > v.capacity) return alert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ!");
  if (budget < totalOrderCost) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!");
  incoming[v.days - 1].push(["A", A], ["B", B], ["C", C]);
  totalCost += totalOrderCost;
  budget -= totalOrderCost;
  queueTruckAnimation(v.days);
  log(`üì¶ –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω (${v.name}): A=${A}, B=${B}, C=${C}, –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: $${v.cost}, –¢–æ–≤–∞—Ä—ã: $${purchaseCost.toFixed(2)}, –ò—Ç–æ–≥–æ: $${totalOrderCost.toFixed(2)}`);
  orderPlacedToday = true;
  updateUI();
}

function nextDay() {
  if (!orderPlacedToday) noOrderDays++; else noOrderDays = 0;
  orderPlacedToday = false;
  log(`<hr><b>üìÖ –î–µ–Ω—å ${day}</b>`);
  const arrivals = incoming.shift();
  arrivals.forEach(([g, q]) => { if (q > 0) { stock[g] += q; log(`üöö –ü–æ–ª—É—á–µ–Ω–æ ${q} –µ–¥. —Ç–æ–≤–∞—Ä–∞ ${g}`); } });
  incoming.push([]);
  truckQueue.forEach(t => t.days--); truckQueue.filter(t => t.days > 0).forEach(showTruck);

  let soldA = 0, soldB = 0, soldC = 0, totalSold = 0, penaltyTotal = 0;
  ["A", "B", "C"].forEach(group => {
    let demand = demandModel[group][day - 1] || 0;
    if (penaltyTimers[group] > 0) {
      const red = group === 'A' ? 0.4 : group === 'B' ? 0.5 : 0.7;
      demand = Math.floor(demand * (1 - red));
      penaltyTimers[group]--;
      log(`üìâ –°–ø—Ä–æ—Å –Ω–∞ ${group} —Å–Ω–∏–∂–µ–Ω –Ω–∞ ${red * 100}%`);
    }
    const sold = Math.min(demand, stock[group]);
    const shortage = demand - sold;
    if (shortage > 0) {
      const p = shortage * 2;
      penaltyTotal += p;
      log(`‚ùó –ö–ª–∏–µ–Ω—Ç –Ω–µ –ø–æ–ª—É—á–∏–ª —Ç–æ–≤–∞—Ä ${group}, —Ä–µ–ø—É—Ç–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞ —Å–Ω–∏–∂–µ–Ω–∞! –®—Ç—Ä–∞—Ñ: $${p.toFixed(2)}`);
      shortages[group]++;
      if (shortages[group] >= 2 && penaltyTimers[group] === 0) {
        penaltyTimers[group] = 5;
        log(`‚ö†Ô∏è –°–ø—Ä–æ—Å –Ω–∞ ${group} –±—É–¥–µ—Ç —Å–Ω–∏–∂–µ–Ω –Ω–∞ 5 –¥–Ω–µ–π`);
        shortages[group] = 0;
      }
    } else {
      shortages[group] = 0;
    }
    stock[group] -= sold;
    totalSold += sold;
    if (group === 'A') soldA = sold;
    if (group === 'B') soldB = sold;
    if (group === 'C') soldC = sold;
    log(`üõí ${group}: —Å–ø—Ä–æ—Å ${demand}, –ø—Ä–æ–¥–∞–Ω–æ ${sold}, –¥–µ—Ñ–∏—Ü–∏—Ç ${shortage}`);
  });

  const revenue = soldA * 4.5 + soldB * 5.5 + soldC * 7;
  const hold = (day % 3 === 0) ? storageFee() : 0;
  budget += revenue - hold - salary - rent - penaltyTotal;
  totalCost += hold + salary + rent + penaltyTotal;

  if (day % 5 === 0) {
    salary *= 1.15; rent *= 1.15;
    log(`‚¨ÜÔ∏è –†–æ—Å—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã –∏ –∞—Ä–µ–Ω–¥—ã: –∑–∞—Ä–ø–ª–∞—Ç–∞ $${salary.toFixed(2)}, –∞—Ä–µ–Ω–¥–∞ $${rent.toFixed(2)}`);
  }
  if (day % 10 === 0) {
    const tax = budget * 0.16;
    budget -= tax;
    totalCost += tax;
    log(`üí∏ –ù–∞–ª–æ–≥ 16%: -$${tax.toFixed(2)}`);
  }

  if (hold > 0) log(`üì¶ –•—Ä–∞–Ω–µ–Ω–∏–µ (—Ä–∞–∑ –≤ 3 –¥–Ω—è): $${hold.toFixed(2)}`);
log(`üíµ –í—ã—Ä—É—á–∫–∞: $${revenue.toFixed(2)} | –ó–∞—Ä–ø–ª–∞—Ç–∞: $${salary.toFixed(2)} | –ê—Ä–µ–Ω–¥–∞: $${rent.toFixed(2)} | –®—Ç—Ä–∞—Ñ—ã: $${penaltyTotal.toFixed(2)}`);
  chartData.labels.push(day);
  chartData.datasets[0].data.push(stock.A + stock.B + stock.C);
  chartData.datasets[1].data.push(totalSold);
  gameChart.update();

  if (budget < 0 || day >= 30) {
    log(budget < 0 ? "‚ùå –ë—é–¥–∂–µ—Ç —É—à—ë–ª –≤ –º–∏–Ω—É—Å. –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!" : "üéâ –í—ã —É—Å–ø–µ—à–Ω–æ —É–ø—Ä–∞–≤–ª—è–ª–∏ –∑–∞–ø–∞—Å–∞–º–∏ 30 –¥–Ω–µ–π!");
    document.querySelector("button[onclick='nextDay()']").disabled = true;
    document.querySelector("button[onclick='placeOrder()']").disabled = true;
  }
  day++;
  updateUI();
}

function storageFee() {
  let fee = 0;
  for (const group in stock) {
    const qty = stock[group];
    if (qty <= 40) fee += qty * 0.3;         // –±—ã–ª–æ 0.4
else if (qty <= 80) fee += qty * 0.75;   // –±—ã–ª–æ 1.0
else fee += qty * 1.3;                   // –±—ã–ª–æ 1.8

    if (qty > 70) {
      const over = qty - 70;
      const fine = over * 1.5;
      log(`‚ö†Ô∏è –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ ${group}: $${fine.toFixed(2)}`);
      fee += fine;
    }
  }
  return fee;
}

function queueTruckAnimation(days) {
  truckQueue.push({ days });
}
function showTruck() {
  const truck = document.createElement("div");
  truck.className = "truck";
  truck.textContent = "üöö";
  truck.style.animationDuration = "1000ms";
  truckAnim.appendChild(truck);
  setTimeout(() => { truck.remove(); }, 1000);
}

function updateOrderSummary() {
  const v = vehicles[document.getElementById("vehicle").value];
  const A = +document.getElementById("orderA").value || 0;
  const B = +document.getElementById("orderB").value || 0;
  const C = +document.getElementById("orderC").value || 0;
  const costA = A * purchasePrice.A;
  const costB = B * purchasePrice.B;
  const costC = C * purchasePrice.C;
  const transport = v.cost;
  const total = costA + costB + costC + transport;
  document.getElementById("costA").textContent = costA.toFixed(2);
  document.getElementById("costB").textContent = costB.toFixed(2);
  document.getElementById("costC").textContent = costC.toFixed(2);
  document.getElementById("transportCost").textContent = transport.toFixed(2);
  document.getElementById("totalOrderCost").textContent = total.toFixed(2);
}

["orderA", "orderB", "orderC", "vehicle"].forEach(id => {
  document.getElementById(id).addEventListener("input", updateOrderSummary);
});
updateOrderSummary();
updateUI();
</script>
</body>
</html>
